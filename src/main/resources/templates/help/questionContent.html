<!doctype html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="fragment/_layout">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <title>타이틀</title>
    <script th:inline="javascript">
            let commentsDIV;
            let originalTopPosition; // 원래 위치의 top 값을 저장할 변수
            $(document).ready(() => {
                let help = JSON.parse([[${help}]]);
                setBoard(help);
                let comments = help.comments;
                commentsDIV = $('#comments');
                
                comments.forEach(comment => {
                    addChildComment(comment, commentsDIV);
                });
            });
            function addChildComment(comment, parentElement) {

                let depth = comment.depth;
                let commentDIV = $('<div></div>').addClass('comment row');
                let writer = $('<div></div>').addClass('writer col-md-1').text(comment.member.name);
                let commentText = $('<div></div>').addClass('content col-md-9').text(comment.content);
                let cat = comment.createdAt+"";
                if(depth=='1'){
                    commentDIV.css('margin','0 auto');
                }

                let commentAt = $('<div></div>').addClass('created_at col-md-2 text-end').text(cat.replaceAll(/,/g, ':'));
                
                commentDIV.append(writer).append(commentText).append(commentAt);

                let childComments = comment.childComments;
                if (childComments.length > 0) {
                    let childCommentsDIV = $("<div></div>").addClass('commentList');
                    childComments.forEach(childComment => {
                        addChildComment(childComment, childCommentsDIV);
                    });
                    commentDIV.append(childCommentsDIV);
                }
                parentElement.append(commentDIV);
            }
            
            function setBoard(help){
                $('#board_title').text(help.title);
                $('#board_writer').text(help.member.name);
                $('#board_content').text(help.content);
            }

            function xy(){
              var commentInsert = $('#comment_insert');
              var commentInput = $('#comment_input');
              var commentTopPosition = commentInsert.position().top;

              // 댓글 입력 전 원래 위치의 top 값을 저장
              originalTopPosition = commentTopPosition;

              // 댓글 입력 후 재조정
              adjustOverflow();

              // 입력 후 원래 위치로 돌아오는 애니메이션 설정
              commentInsert.animate({ top: originalTopPosition }, 300);

              // 폼 전송 방지
              return false;
            }
    </script>
    <style>


/* 게시판 스타일 */
#board {
  width:100%;
  margin-bottom: 20px;
  padding: 20px;
  border: 1px solid #ccc;
  background-color: #f9f9f9;
}

/* 제목 스타일 */
#board_title {
  font-size: 24px;
  font-weight: bold;
  margin-bottom: 10px;
}

/* 작성자 스타일 */
#board_writer {
  font-size: 14px;
  color: #555;
  margin-bottom: 10px;
}

/* 내용 스타일 */
#board_content {
  margin-bottom: 20px;
}



/* 댓글 스타일 */
.comment {
  width:100%;
  background-color: #f9f9f9;
  margin-left: auto;
}

/* 작성자 스타일 */
.comment .writer {
  font-size: 14px;
  color: #555;
  margin-bottom: 5px;
}

/* 내용 스타일 */
.comment .content {
  margin-bottom: 10px;
}

/* 작성 시간 스타일 */
.created_at {
  font-size: 11px;
  color: #999;
}

/* 대댓글 스타일 */
.commentList {
  padding-left: 20px;  
}

/* 댓글 입력창 스타일 */
#comment_insert {
  margin-top: 20px;
}

#comment_input {
  width: 100%;
  height: 100px;
  margin-bottom: 10px;
  padding: 5px;
}

.btn {
  background-color: #ccc;
  color: #fff;
  border: none;
  padding: 5px 10px;
  cursor: pointer;
}
@media (min-width: 768px) {
  .container {
    width: 750px;
  }
}

@media (min-width: 992px) {
  .container {
    width: 970px;
  }
}

@media (min-width: 1200px) {
  .container {
    width: 1170px;
  }
}
    </style>
</head>
<body>
<div layout:fragment="content">
    <section id="boardSet" class="container">
        <article id="board">
            <div id="board_title"></div>
            <div id="board_writer"></div>
            <div id="board_content"></div>
        </article>
        <article id="comments">

        </article>
        <article id="comment_insert" class="input-group">
          <form th:action="@{/}" onsubmit="return xy();">
            <input type="hidden" name="area">
            <textarea name="comment_input" id="comment_input" cols="30" rows="10"></textarea>
            <button class="btn">입력</button>
          </form>
        </article>
        
    </section>

</div>
</body>
</html>