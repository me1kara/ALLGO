<!doctype html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="fragment/_layout">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://use.fontawesome.com/releases/v5.2.0/js/all.js"></script>
    <link rel="stylesheet" th:href="@{/css/mypage.css}">

    <title>타이틀</title>
    <script>
        $(document).ready(function(){
            $('#modifyPhoneBtn').on('click',()=>{
                document.getElementById('modifyPhoneModal').showModal();
            });
            $('#modifyEmailBtn').on('click',()=>{
                document.getElementById('modifyEmailModal').showModal();
            });
            $('#modifyPasswordBtn').on('click',()=>{
                document.getElementById('modifyPasswordModal').showModal();
            });
        })
        function verifyPhone() {
            // 폼에 입력된 전화번호 가져오기
            const phoneNumber = document.getElementById("phoneInput").value;
            // 백엔드 API 호출
            $.ajax({
                url: "/member/checkPhone",
                type: "POST",
                data: {'phone': phoneNumber},
                beforeSend: function(xhr){
                    xhr.setRequestHeader(header, token);
                },
                success: function(response) {
                    document.querySelector('#phoneCode-wrap').style.display='block';     
                    document.querySelector('#phoneCodeBtn').addEventListener('click',function(){
                        let code = $('#phone-code').val();
                        if(response==code){
                            alert('일치합니다!');
                        }else {
                            alert('불일치합니다!');
                        }
                    })
                    
                    
                },
                error: function() {
                    console.error("유효하지 않은 번호입니다!");
                }
            });
        }

        function verifyEmail() {
            const email = document.getElementById("emailInput").value;
            // 백엔드 API 호출
            $.ajax({
                url: "/member/checkEmail",
                type: "POST",
                data: {'email': email},
                beforeSend: function(xhr){
                    xhr.setRequestHeader(header, token);
                },
                success: function(response) {
                    document.querySelector('#emailCode-wrap').style.display='block';     
                    document.querySelector('#emailCodeBtn').addEventListener('click',function(){
                        let code = $('#email-code').val();
                        if(response==code){
                            alert('일치합니다!');
                        }else {
                            phoneCheck = false;
                            alert('불일치합니다!');
                        }
                    })
  
                },
                error: function() {
                    console.error("유효하지 않은 이메일입니다!");
                }
            });
        }

    </script>

    <style>
        #info-content > .row{
            margin-bottom: 10px;
        }

        #info-content > .row > h6{
            border-right: lightgray 1px solid;
        }
      
    </style>
</head>
<body>
    <div layout:fragment="content" >
    <main style="padding-top:10px;" class="container">
            <section id="item-list">
                <ul>
                    <!-- 클릭시 해당 목록 오른쪽에 나열 -->
                    <li><a th:href="@{/member/myPage?item=cart}" id="cart">장바구니</a></li>
                    <li><a th:href="@{/member/myPage?item=orderList}" id="orderList">주문조회</a></li>
                    <li><a th:href="@{/member/myInformationList}" id="myInformation" style="background-color: #ECECEC;">내정보관리</a></li>
                </ul>
            </section>
            <section id="item-content" style="border-top:black 1px solid;">
                <h3 id="info-title" class="text-secondary">개인정보</h4>
                <article id="info-content" class="container">
                    <div class="row">
                        <h6 class="col-sm-4">ID</h6>
                        <p class="col-sm-8" th:text="${member.id}">길동</p> 
                    </div>
                    <div class="row">
                        <h6 class="col-sm-4">이름</h6>
                        <p class="col-sm-8" th:text="${member.name}">길동</p> 
                    </div>
                    <div class="row">
                        <h6 class="col-sm-4">휴대폰번호</h6>
                        <p class="col-sm-6" th:text="${member.phone}"></p>
                        <button id="modifyPhoneBtn" class="col-sm-2 btn btn-sm btn-secondary" style="max-width: 100px;max-height: 31px;">변경</button> 
                    </div>
                    <div class="row">
                        <h6 class="col-sm-4">이메일</h6>
                        <p class="col-sm-6" th:text="${member.email}"></p>
                        <button id="modifyEmailBtn"class="col-sm-2 btn btn-sm btn-secondary" style="max-width: 100px; max-height: 31px;">변경</button> 
                    </div>
                    <div class="row">
                        <h6 class="col-sm-4">주소</h6>
                        <p class="col-sm-6" th:text="${member.address}"></p>
                        <button class="col-sm-2 btn btn-sm btn-secondary" style="max-width: 100px; max-height: 31px;">변경</button> 
                    </div>
                    <div class="row">
                        <h6 class="col-sm-10">비밀번호</h6>
                        <button id="modifyPasswordBtn" class="col-sm-2 btn btn-sm btn-secondary" style="max-width: 100px; max-height: 31px;">변경</button>
                    </div>
                </article>
            </section>
        </main>
        <div style="clear: both;"></div>
    </div>
    <dialog id="modifyPhoneModal">
        <form method="dialog" style="text-align: right;">
            <button><i class="fa-regular fa-xmark" style="color: #e60f0f;"></i></button>
        </form>
        <h5>회원님의 휴대폰번호를 변경하기위해 휴대폰 인증이 필요합니다.</h5>
        <label for="passwordInput">휴대폰번호</label>
        <div class="input-group">
            <input type="text" id="phoneInput" class="input-group-text">
            <button class="input-group-append btn btn-sm btn-outline-secondary">변경</button>
        </div>
        <div class="input-group" id="phoneCode-wrap" style="display: none;">
            <input type="text" id="phone-code" class="input-group-text">
            <button id="phoneCodeBtn" class="input-group-append btn btn-sm btn-outline-secondary">확인</button>
        </div>
    </dialog>
    
    <dialog id="modifyEmailModal">
        <form method="dialog" style="text-align: right;">
            <button><i class="fa-regular fa-xmark" style="color: #e60f0f;"></i></button>
        </form>
        <h5>회원님의 이메일을 변경하기위해 이메일 인증이 필요합니다.</h5>
        <label for="passwordInput">이메일</label>
        <div class="input-group">
            <input type="text" id="emailInput" class="input-group-text">
            <button class="input-group-append btn btn-sm btn-outline-secondary">변경</button>
        </div>
        <div class="input-group" id="emailCode-wrap">
            <input type="text" id="email-code" class="input-group-text">
            <button id="emailCodeBtn" class="input-group-append btn btn-sm btn-outline-secondary">변경</button>
        </div>
    </dialog>
    <dialog id="modifyPasswordModal">
        <form method="dialog" style="text-align: right;">
            <button><i class="fa-regular fa-xmark" style="color: #e60f0f;"></i></button>
        </form>
        <h5>회원님의 비밀번호를 변경하기위해 비밀번호 인증이 필요합니다.</h5>
        <label for="passwordInput">비밀번호</label>
        <input type="password" id="passwordInput" class="form-control" style="max-width: 250px;">
        <label for="newPassword">변경할 비밀번호</label>
        <input type="password" id="newPassword" class="form-control" style="max-width: 250px;">
        <label for="newPasswordConfirm">변경할 비밀번호 확인</label>
        <input type="password" id="newPasswordConfirm" class="form-control" style="max-width: 250px;">
        <div style="text-align: center;">
            <button class="input-group-append btn btn-sm btn-outline-success">변경</button>
        </div>
    </dialog>
    
</body>
</html>